{
    "contents" : "StartDay=\"6-23-2013\"\nEndDay=\"9-14-2013\"\n\n# Retrieving sql\nlibrary(stringr)\nsetwd(\"C:/Users/jeremyp.HTC/Documents/Development/Vertex/R/HealthWelfare_Hours\")\nSQL<-paste(readLines(\"HealthWelfare.sql\",encoding=\"UTF-8\"),collapse=' ')\nSQL<-str_replace_all(SQL[1],'\\t','')\nSQL<-str_replace(SQL[1],'@StartDay',paste(\"\\'\",StartDay,\"\\'\",sep=\"\"))\nSQL<-str_replace(SQL[1],'@EndDay',paste(\"\\'\",EndDay,\"\\'\",sep=\"\"))\n\n\n#Returning data set to \nlibrary(\"RODBC\", lib.loc=\"C:/Program Files/R/R-2.15.2/library\")\nodbc<-odbcConnect(\"Vertex\",uid=\"sysdba\",pwd=\"masterkey\")\nHealthWelfare<-data.frame(sqlQuery(odbc,SQL[1]))\n\n# Retrieving sql\nlibrary(stringr)\nsetwd(\"C:/Users/jeremyp.HTC/Documents/Development/Vertex/R/HealthWelfare_Hours\")\nSQL<-paste(readLines(\"Hours.sql\",encoding=\"UTF-8\"),collapse=' ')\nSQL<-str_replace_all(SQL[1],'\\t','')\nSQL<-str_replace(SQL[1],'@StartDay',paste(\"\\'\",StartDay,\"\\'\",sep=\"\"))\nSQL<-str_replace(SQL[1],'@EndDay',paste(\"\\'\",EndDay,\"\\'\",sep=\"\"))\n\nHours<-data.frame(sqlQuery(odbc,SQL[1]))\ncolnames(Hours)<- c(\"Employee\",\"EmployeeNumber\",\"Department\" ,\"JobNumber\", \"JobDescription\", \"Productivity\",\"Hours\",\"Earnings\",\"Pieces\")\nHours$Productivity<-round(Hours$Productivity,digits=2)\nHours$Hours<-round(Hours$Hours,digits=2)\nHours$Earnings<-round(Hours$Earnings,digits=2)\nHours$Productivity<-ifelse(Hours$Productivity==0.00,\"\",Hours$Productivity)\n\nodbcCloseAll()\nrm(odbc)\n\nlibrary(\"plyr\", lib.loc=\"C:/Program Files/R/R-2.15.2/library\")\n# getting the job the employee worked the max number of hours at\nmaxHours <- ddply(Hours, \"Employee\", summarise, Hrs=max(Hours), EmployeeNumber=EmployeeNumber[which.max(Hours)],Department=Department[which.max(Hours)], Job=JobNumber[which.max(Hours)], Description=JobDescription[which.max(Hours)], Productivity=Productivity[which.max(Hours)])\nmaxHours<- maxHours[,c(3,1,4,5,6,2,7)]\n\n\n\n#Making Adjustments to HealthWelfare\ncolnames(HealthWelfare)<- c(\"EmployeeNumber\",\"JobNumber\", \"HealthWelfare\")\nHealthWelfare$HealthWelfare<-round(HealthWelfare$HealthWelfare,digits=2)\n\n\nHealthWelfare<- merge(HealthWelfare, Hours,by=c(\"EmployeeNumber\",\"JobNumber\"),all.y=TRUE) \nHealthWelfare<-HealthWelfare[,c(1,4,5,2,6,7,8,9,3,10)]\n\n#Removing rows with a job number = NA\nHealthWelfare<-HealthWelfare[! is.na(HealthWelfare$JobNumber),]\nHealthWelfare$Job<-as.numeric(substr(HealthWelfare$JobNumber,1,1))\n\nHealthWelfare$Job<-ifelse(HealthWelfare$Job == 1, 'Nish', ifelse(HealthWelfare$Job > 2, 'Commercial', 'NYSLD'))\n\n# Creating spreadsheets\nlibrary(\"rJava\", lib.loc=\"C:/Program Files/R/R-2.15.2/library\")\nlibrary(\"xlsxjars\", lib.loc=\"C:/Program Files/R/R-2.15.2/library\")\nlibrary(\"xlsx\", lib.loc=\"C:/Program Files/R/R-2.15.2/library\")\n\n# Saving Health Welfare data to spreadsheet\nwsName<-\"HealthWelfare\"\nwbName<-paste(\"HW_\",wsName,\".xlsx\",sep=\"\")\n\nWB<- createWorkbook()\nshtHW<-createSheet(WB,sheetName=wsName)\n\nrowStyle <- CellStyle(WB) + Font(WB, name='Courier New',heightInPoints=8) \nhdrStyle <- CellStyle(WB) + Font(WB, isBold=TRUE, name='calibri',underline=TRUE,heightInPoints=10)# header\naddDataFrame(HealthWelfare, shtHW, startRow=1, startColumn=1, colnamesStyle=hdrStyle, row.names=FALSE,showNA=FALSE,  colStyle=list('1'=rowStyle,'2'=rowStyle,'3'=rowStyle,'4'=rowStyle,'5'=rowStyle,'6'=rowStyle,'7'=rowStyle,'8'=rowStyle, '9'=rowStyle, '10'=rowStyle, '11'=rowStyle))\nautoSizeColumn(shtHW,colIndex=1:11)\n\nrm(HealthWelfare,SQL, wsName)\n\n#Saving maxHours data to spreadsheet\nmaxHours$Pieces<-NULL\nmaxHours$Earnings<-NULL\nwsName<-\"Hours\"\n\nshtHours<-createSheet(WB,sheetName=wsName)\naddDataFrame(maxHours, shtHours, startRow=1, startColumn=1, colnamesStyle=hdrStyle, row.names=FALSE,showNA=FALSE,  colStyle=list('1'=rowStyle,'2'=rowStyle,'3'=rowStyle,'4'=rowStyle,'5'=rowStyle,'6'=rowStyle,'7'=rowStyle))\nautoSizeColumn(shtHours,colIndex=1:7)\n\n\n# Don't forget to save the workbook ...\nsetwd(\"C:/Users/jeremyp.HTC/Documents/Temp\")\nsaveWorkbook(WB, wbName)\nrm(Hours,shtHours,shtHW, WB,wsName, EndDay, StartDay,hdrStyle,rowStyle,wbName,maxHours)",
    "created" : 1379605167077.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1035173130",
    "id" : "B484AF73",
    "lastKnownWriteTime" : 1377605773,
    "path" : "~/Development/Vertex/R/HealthWelfare_Hours/HealthWelfare.r",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}